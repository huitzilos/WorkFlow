<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlowWare - Workflows de Almac√©n</title>
    <link rel="stylesheet" href="./styles/main.css">
    <link rel="stylesheet" href="./styles/components.css">
    <link rel="stylesheet" href="./styles/nodes.css">
    <link rel="stylesheet" href="./styles/wizard.css"> <!-- Enlace al nuevo CSS -->
</head>

<body>
    <div class="app">
        <!-- Sidebar con paleta de nodos -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1 class="logo">
                    <span class="logo-icon">‚ö°</span>
                    FlowWare
                </h1>
            </div>

            <div class="node-palette">
                <!-- Disparadores -->
                <section class="palette-section">
                    <h3 class="section-title">
                        <span class="section-icon">üéØ</span>
                        Disparadores
                    </h3>
                    <div class="node-list">
                        <div class="node-item" data-type="trigger" data-subtype="entrada">
                            <div class="node-preview trigger">
                                <span class="node-icon">üì¶</span>
                            </div>
                            <div class="node-info">
                                <div class="node-name">Orden de Entrada</div>
                                <div class="node-desc">Productos que llegan</div>
                            </div>
                        </div>

                        <div class="node-item" data-type="trigger" data-subtype="salida">
                            <div class="node-preview trigger">
                                <span class="node-icon">üöõ</span>
                            </div>
                            <div class="node-info">
                                <div class="node-name">Orden de Salida</div>
                                <div class="node-desc">Productos que salen</div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Acciones -->
                <section class="palette-section">
                    <h3 class="section-title">
                        <span class="section-icon">‚öôÔ∏è</span>
                        Acciones
                    </h3>
                    <div class="node-list">
                        <div class="node-item" data-type="action" data-subtype="recepcion">
                            <div class="node-preview action">
                                <span class="node-icon">üì•</span>
                            </div>
                            <div class="node-info">
                                <div class="node-name">Recepci√≥n</div>
                                <div class="node-desc">Recibir productos</div>
                            </div>
                        </div>

                        <div class="node-item" data-type="action" data-subtype="verificar-stock">
                            <div class="node-preview action">
                                <span class="node-icon">üìä</span>
                            </div>
                            <div class="node-info">
                                <div class="node-name">Verificar Stock</div>
                                <div class="node-desc">Revisar inventario</div>
                            </div>
                        </div>

                        <div class="node-item" data-type="action" data-subtype="almacenaje">
                            <div class="node-preview action">
                                <span class="node-icon">üè™</span>
                            </div>
                            <div class="node-info">
                                <div class="node-name">Almacenaje</div>
                                <div class="node-desc">Almacenar productos</div>
                            </div>
                        </div>

                        <div class="node-item" data-type="action" data-subtype="etiquetar">
                            <div class="node-preview action">
                                <span class="node-icon">üè∑Ô∏è</span>
                            </div>
                            <div class="node-info">
                                <div class="node-name">Generar Etiqueta</div>
                                <div class="node-desc">C√≥digo de barras</div>
                            </div>
                        </div>

                        <div class="node-item" data-type="action" data-subtype="reabastecer">
                            <div class="node-preview action">
                                <span class="node-icon">üìà</span>
                            </div>
                            <div class="node-info">
                                <div class="node-name">Reabastecer</div>
                                <div class="node-desc">Reponer inventario</div>
                            </div>
                        </div>

                        <div class="node-item" data-type="action" data-subtype="picking">
                            <div class="node-preview action">
                                <span class="node-icon">üîç</span>
                            </div>
                            <div class="node-info">
                                <div class="node-name">Picking</div>
                                <div class="node-desc">Recolectar productos</div>
                            </div>
                        </div>

                        <div class="node-item" data-type="action" data-subtype="packing">
                            <div class="node-preview action">
                                <span class="node-icon">üì¶</span>
                            </div>
                            <div class="node-info">
                                <div class="node-name">Packing</div>
                                <div class="node-desc">Empacar productos</div>
                            </div>
                        </div>

                        <div class="node-item" data-type="action" data-subtype="mover-a">
                            <div class="node-preview action">
                                <span class="node-icon">üìç</span>
                            </div>
                            <div class="node-info">
                                <div class="node-name">Mover a</div>
                                <div class="node-desc">Reubicar productos</div>
                            </div>
                        </div>

                        <div class="node-item" data-type="action" data-subtype="embarque">
                            <div class="node-preview action">
                                <span class="node-icon">üöö</span>
                            </div>
                            <div class="node-info">
                                <div class="node-name">Embarque</div>
                                <div class="node-desc">Cargar veh√≠culo</div>
                            </div>
                        </div>

                        <div class="node-item" data-type="action" data-subtype="envio">
                            <div class="node-preview action">
                                <span class="node-icon">üöõ</span>
                            </div>
                            <div class="node-info">
                                <div class="node-name">Env√≠o</div>
                                <div class="node-desc">Despachar productos</div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Condiciones -->
                <section class="palette-section">
                    <h3 class="section-title">
                        <span class="section-icon">‚ùì</span>
                        Condiciones
                    </h3>
                    <div class="node-list">
                        <div class="node-item" data-type="condition" data-subtype="stock-disponible">
                            <div class="node-preview condition">
                                <span class="node-icon">üìà</span>
                            </div>
                            <div class="node-info">
                                <div class="node-name">Stock Disponible</div>
                                <div class="node-desc">Verificar cantidad</div>
                            </div>
                        </div>

                        <div class="node-item" data-type="condition" data-subtype="prioridad">
                            <div class="node-preview condition">
                                <span class="node-icon">‚≠ê</span>
                            </div>
                            <div class="node-info">
                                <div class="node-name">Prioridad Alta</div>
                                <div class="node-desc">Pedidos urgentes</div>
                            </div>
                        </div>

                        <div class="node-item" data-type="condition" data-subtype="categoria">
                            <div class="node-preview condition">
                                <span class="node-icon">üè∑Ô∏è</span>
                            </div>
                            <div class="node-info">
                                <div class="node-name">Por Categor√≠a</div>
                                <div class="node-desc">Filtrar por tipo</div>
                            </div>
                        </div>

                        <div class="node-item" data-type="condition" data-subtype="ubicacion">
                            <div class="node-preview condition">
                                <span class="node-icon">üìç</span>
                            </div>
                            <div class="node-info">
                                <div class="node-name">Por Ubicaci√≥n</div>
                                <div class="node-desc">Verificar zona</div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Notificaciones -->
                <section class="palette-section">
                    <h3 class="section-title">
                        <span class="section-icon">üì¢</span>
                        Notificaciones
                    </h3>
                    <div class="node-list">
                        <div class="node-item" data-type="notification" data-subtype="email">
                            <div class="node-preview notification">
                                <span class="node-icon">üìß</span>
                            </div>
                            <div class="node-info">
                                <div class="node-name">Enviar Email</div>
                                <div class="node-desc">Notificaci√≥n por correo</div>
                            </div>
                        </div>

                        <div class="node-item" data-type="notification" data-subtype="sistema">
                            <div class="node-preview notification">
                                <span class="node-icon">üîî</span>
                            </div>
                            <div class="node-info">
                                <div class="node-name">Alerta Sistema</div>
                                <div class="node-desc">Notificaci√≥n interna</div>
                            </div>
                        </div>

                        <div class="node-item" data-type="notification" data-subtype="sms">
                            <div class="node-preview notification">
                                <span class="node-icon">üì±</span>
                            </div>
                            <div class="node-info">
                                <div class="node-name">Enviar SMS</div>
                                <div class="node-desc">Mensaje de texto</div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </aside>

        <!-- Canvas principal -->
        <main class="workspace">
            <header class="workspace-header">
                <div class="header-content">
                    <div class="header-info">
                        <h2 class="workspace-title">Workflow de Almac√©n</h2>
                        <p class="workspace-subtitle">Dise√±a flujos automatizados</p>
                    </div>
                    <div class="header-actions">
                        <button class="btn btn-secondary" onclick="WorkflowManager.loadTemplate('recepcion-completa')">
                            <span>üì•</span> Demo Entrada
                        </button>
                        <button class="btn btn-secondary" onclick="WorkflowManager.loadTemplate('salida-simple')">
                            <span>üöõ</span> Demo Salida Simple
                        </button>
                        <button class="btn btn-secondary" onclick="WorkflowManager.loadTemplate('salida-completa')">
                            <span>üì¶</span> Demo Salida Completa
                        </button>
                        <button class="btn btn-secondary" onclick="WorkflowManager.load()">
                            <span>üìÇ</span> Cargar
                        </button>
                        <button class="btn btn-secondary" onclick="WorkflowManager.clear()">
                            <span>üóëÔ∏è</span> Limpiar
                        </button>
                        <button class="btn btn-primary" onclick="WorkflowManager.save()">
                            <span>üíæ</span> Guardar
                        </button>
                        <button id="show-wizard-btn" class="btn btn-accent" style="margin-left: 10px;">
                            <span>‚ú®</span> Configuraci√≥n Inicial
                        </button>
                    </div>
                </div>
            </header>

            <div class="canvas-container">
                <div id="canvas" class="canvas">
                    <svg class="connections-layer" id="connections-svg">
                        <!-- Conexiones se renderizan aqu√≠ -->
                    </svg>

                    <div class="empty-state" id="empty-state">
                        <div class="empty-icon">üéØ</div>
                        <h3>Comienza tu workflow</h3>
                        <p>Arrastra nodos desde el panel lateral</p>
                    </div>
                </div>
            </div>

            <footer class="workspace-footer">
                <div class="footer-stats">
                    <span id="node-count">0 nodos</span>
                    <span id="connection-count">0 conexiones</span>
                    <span>Zoom: <span id="zoom-level">100%</span></span>
                </div>
                <div class="zoom-controls">
                    <button class="zoom-btn" onclick="canvasManager.zoomOut()" title="Alejar">‚àí</button>
                    <button class="zoom-btn" onclick="canvasManager.resetZoom()" title="Restablecer">‚åÇ</button>
                    <button class="zoom-btn" onclick="canvasManager.zoomIn()" title="Acercar">+</button>
                </div>
            </footer>
        </main>

        <!-- Panel de configuraci√≥n -->
        <aside class="config-panel" id="config-panel">
            <div class="config-header">
                <h3>Configuraci√≥n</h3>
                <button class="config-close" onclick="window.FlowWare.State.nodes.deselectNode()">√ó</button>
            </div>
            <div class="config-content">
                <div class="form-group">
                    <label for="node-name">Nombre del nodo</label>
                    <input type="text" id="node-name" class="form-input" placeholder="Ingresa un nombre">
                </div>
                <div class="form-group">
                    <label for="node-description">Descripci√≥n</label>
                    <textarea id="node-description" class="form-input" rows="3"
                        placeholder="Describe la funci√≥n"></textarea>
                </div>

                <!-- Secci√≥n espec√≠fica para "Generar Etiquetas" -->
                <div id="config-etiquetar-specific" class="config-specific-section" style="display: none;">
                    <hr>
                    <h4>Configuraci√≥n de Etiquetas</h4>
                    <div class="form-group">
                        <label for="node-etiqueta-tipo">Tipo de Etiqueta</label>
                        <select id="node-etiqueta-tipo" class="form-input">
                            <option value="codigo_barras">C√≥digo de Barras</option>
                            <option value="qr">C√≥digo QR</option>
                            <option value="rfid">RFID</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="node-etiqueta-trazabilidad">Nivel de Trazabilidad</label>
                        <select id="node-etiqueta-trazabilidad" class="form-input">
                            <option value="pallet">Pallet</option>
                            <option value="caja">Pallet ‚Üí Caja</option>
                            <option value="subpaquete">Pallet ‚Üí Caja ‚Üí Subpaquete</option>
                        </select>
                    </div>
                </div>
                <!-- Fin Secci√≥n espec√≠fica para "Generar Etiquetas" -->

            </div>
        </aside>
    </div>

    <!-- Scripts modulares -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/uuid/8.3.2/uuid.min.js"></script>
    <script src="./js/config.js"></script>
    <script src="./js/utils.js"></script>
    <script src="./js/canvas-manager.js"></script>
    <script src="./js/node-manager.js"></script>
    <script src="./js/connection-manager.js"></script>
    <script src="./js/workflow-manager.js"></script>
    <!-- App.js debe ir antes que los managers que dependen de FlowWare.Utils -->
    <script src="./js/app.js"></script>
    <script src="./js/wizard-manager.js"></script>

    <!-- Wizard Modal -->
    <div id="config-wizard" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="max-width: 700px; width: 90%;">
            <div class="modal-header">
                <h2>Asistente de Configuraci√≥n Inicial</h2>
                <button id="close-wizard-btn" class="modal-close-btn">&times;</button>
            </div>
            <div class="wizard-steps">
                <div class="wizard-step active" data-step="1">
                    <h3>Paso 1: Informaci√≥n de la Compa√±√≠a</h3>
                    <form id="wizard-company-form">
                        <div class="form-group">
                            <label for="company-name">Nombre de la Compa√±√≠a <span class="required">*</span></label>
                            <input type="text" id="company-name" class="form-input" required>
                            <div class="error-message"></div>
                        </div>
                        <div class="form-group">
                            <label for="company-address1">Domicilio 1 <span class="required">*</span></label>
                            <input type="text" id="company-address1" class="form-input" required>
                            <div class="error-message"></div>
                        </div>
                        <div class="form-group">
                            <label for="company-address2">Domicilio 2</label>
                            <input type="text" id="company-address2" class="form-input">
                        </div>
                        <div class="form-group">
                            <label for="company-country">Pa√≠s <span class="required">*</span></label>
                            <select id="company-country" class="form-input" required>
                                <option value="">Seleccione un pa√≠s</option>
                                <option value="MX">M√©xico</option>
                                <option value="US">Estados Unidos</option>
                                <option value="CA">Canad√°</option>
                                <option value="CO">Colombia</option>
                                <option value="ES">Espa√±a</option>
                                <!-- A√±adir m√°s pa√≠ses seg√∫n sea necesario -->
                            </select>
                            <div class="error-message"></div>
                        </div>
                        <div class="form-group">
                            <label for="company-state">Estado/Provincia <span class="required">*</span></label>
                            <input type="text" id="company-state" class="form-input" required>
                            <div class="error-message"></div>
                        </div>
                         <div class="form-group">
                            <label for="company-lada">Lada</label>
                            <input type="tel" id="company-lada" class="form-input" placeholder="Ej: 52">
                            <div class="error-message"></div>
                        </div>
                        <div class="form-group">
                            <label for="company-phone1">N√∫mero de Tel√©fono Fijo <span class="required">*</span></label>
                            <input type="tel" id="company-phone1" class="form-input" required placeholder="Ej: 5512345678">
                            <div class="error-message"></div>
                        </div>
                        <div class="form-group">
                            <label for="company-phone2">N√∫mero de Tel√©fono Extra</label>
                            <input type="tel" id="company-phone2" class="form-input">
                            <div class="error-message"></div>
                        </div>
                        <div class="form-group">
                            <label for="company-capacity">Capacidad en M2 <span class="required">*</span></label>
                            <input type="number" id="company-capacity" class="form-input" required min="1">
                            <div class="error-message"></div>
                        </div>
                    </form>
                </div>
                <div class="wizard-step" data-step="2">
                    <h3>Paso 2: Crear Almacenes</h3>
                    <div id="warehouse-forms-container">
                        <!-- Formularios de almac√©n se a√±adir√°n aqu√≠ din√°micamente -->
                    </div>
                    <button type="button" id="add-warehouse-btn" class="btn btn-info" style="margin-top: 15px;">
                        <span class="icon">‚ûï</span> A√±adir Almac√©n
                    </button>
                    <div id="step2-error-message" class="error-message" style="margin-top:10px;"></div>
                </div>
                <div class="wizard-step" data-step="3">
                    <h3>Paso 3: A√±adir Usuarios Administradores</h3>
                    <p>Asigne usuarios administradores a los almacenes creados. Puede a√±adir m√∫ltiples usuarios por almac√©n.</p>
                    <div id="user-assignments-container">
                        <!-- Aqu√≠ se listar√°n los almacenes y sus formularios de usuario -->
                    </div>
                    <div id="step3-error-message" class="error-message" style="margin-top:10px;"></div>
                </div>
                <div class="wizard-step" data-step="4">
                    <h3>Paso 4: Configuraci√≥n de Workflows Generales</h3>
                    <p>Defina los flujos de trabajo generales para las operaciones de sus almacenes. Estos flujos se pueden asignar a uno o varios almacenes.</p>

                    <div class="workflow-config-area">
                        <!-- Secci√≥n Flujo de Entrada -->
                        <div class="workflow-section" id="workflow-entrada">
                            <h4>Flujo de Documento de Entrada</h4>
                            <div class="workflow-palette">
                                <select class="form-input workflow-node-select" data-flow-type="entrada">
                                    <option value="">Seleccionar acci√≥n para a√±adir...</option>
                                    {NODE_OPTIONS_ENTRADA}
                                </select>
                                <button type="button" class="btn btn-secondary btn-sm add-workflow-node-btn" data-flow-type="entrada">A√±adir Acci√≥n</button>
                            </div>
                            <div class="workflow-blocks-container" data-flow-type="entrada">
                                <!-- Bloques para flujo de entrada -->
                            </div>
                        </div>

                        <!-- Secci√≥n Flujo de Almac√©n -->
                        <div class="workflow-section" id="workflow-almacen">
                            <h4>Flujo de Documento de Almac√©n</h4>
                            <div class="workflow-palette">
                                <select class="form-input workflow-node-select" data-flow-type="almacen">
                                    <option value="">Seleccionar acci√≥n para a√±adir...</option>
                                    {NODE_OPTIONS_ALMACEN}
                                </select>
                                <button type="button" class="btn btn-secondary btn-sm add-workflow-node-btn" data-flow-type="almacen">A√±adir Acci√≥n</button>
                            </div>
                            <div class="workflow-blocks-container" data-flow-type="almacen">
                                <!-- Bloques para flujo de almac√©n -->
                            </div>
                        </div>

                        <!-- Secci√≥n Flujo de Salida -->
                        <div class="workflow-section" id="workflow-salida">
                            <h4>Flujo de Documento de Salida</h4>
                            <div class="workflow-palette">
                                <select class="form-input workflow-node-select" data-flow-type="salida">
                                    <option value="">Seleccionar acci√≥n para a√±adir...</option>
                                    {NODE_OPTIONS_SALIDA}
                                </select>
                                <button type="button" class="btn btn-secondary btn-sm add-workflow-node-btn" data-flow-type="salida">A√±adir Acci√≥n</button>
                            </div>
                            <div class="workflow-blocks-container" data-flow-type="salida">
                                <!-- Bloques para flujo de salida -->
                            </div>
                        </div>
                    </div>

                    <hr style="margin: 20px 0;">
                    <h4>Asignar Workflows a Almacenes</h4>
                    <div id="warehouse-assignment-container" class="form-group">
                        <p>Seleccione a qu√© almacenes se aplicar√°n estos workflows generales. Un almac√©n puede tener asignado este conjunto general o un workflow espec√≠fico (Fase 3).</p>
                        <!-- Checkboxes de almacenes se cargar√°n aqu√≠ -->
                    </div>
                    <div id="step4-error-message" class="error-message"></div>
                </div>
                <div class="wizard-step" data-step="5">
                    <h3>Paso 5: Proveedores, Productos y Workflows Espec√≠ficos</h3>
                    <p>Defina proveedores y sus productos. Posteriormente, podr√° configurar flujos de trabajo espec√≠ficos para ellos si es necesario.</p>

                    <div class="content-columns" style="display: flex; gap: 20px;">
                        <!-- Columna de Proveedores -->
                        <div class="column" style="flex: 1; border-right: 1px solid #eee; padding-right: 20px;">
                            <h4>Gesti√≥n de Proveedores</h4>
                            <form id="wizard-provider-form">
                                <div class="form-group">
                                    <label for="provider-name">Nombre del Proveedor <span class="required">*</span></label>
                                    <input type="text" id="provider-name" name="provider-name" class="form-input" required>
                                    <div class="error-message"></div>
                                </div>
                                <div class="form-group">
                                    <label for="provider-id">ID del Proveedor (Opcional)</label>
                                    <input type="text" id="provider-id" name="provider-id" class="form-input">
                                    <div class="error-message"></div>
                                </div>
                                <div class="form-group">
                                    <label for="provider-contact-person">Persona de Contacto</label>
                                    <input type="text" id="provider-contact-person" name="provider-contact-person" class="form-input">
                                </div>
                                <div class="form-group">
                                    <label for="provider-email">Email de Contacto</label>
                                    <input type="email" id="provider-email" name="provider-email" class="form-input">
                                    <div class="error-message"></div>
                                </div>
                                <div class="form-group">
                                    <label for="provider-phone">Tel√©fono de Contacto</label>
                                    <input type="tel" id="provider-phone" name="provider-phone" class="form-input">
                                    <div class="error-message"></div>
                                </div>
                                <button type="button" id="add-provider-btn" class="btn btn-primary">A√±adir Proveedor</button>
                            </form>
                            <hr style="margin: 20px 0;">
                            <h5>Proveedores Existentes:</h5>
                            <ul id="providers-list" class="item-list" style="list-style-type: none; padding-left: 0;">
                                <!-- Proveedores se listar√°n aqu√≠ -->
                                <!-- Ejemplo: <li data-provider-id="p1">Proveedor A <button class="btn-link remove-provider-btn">Eliminar</button></li> -->
                            </ul>
                        </div>

                        <!-- Columna de Productos y Workflows (inicialmente podr√≠a estar oculta o mostrar un placeholder) -->
                        <div class="column" style="flex: 2;">
                            <h4 id="selected-provider-area-title">Seleccione un Proveedor</h4>
                            <div id="provider-specific-content" style="display: none;">
                                <div id="product-management-section">
                                    <h5>Gesti√≥n de Productos para <span id="product-management-provider-name"></span></h5>
                                    <form id="wizard-product-form">
                                        <div class="form-group">
                                            <label for="product-name">Nombre del Producto <span class="required">*</span></label>
                                            <input type="text" id="product-name" name="product-name" class="form-input" required>
                                            <div class="error-message"></div>
                                        </div>
                                        <div class="form-group">
                                            <label for="product-sku">SKU/ID del Producto <span class="required">*</span></label>
                                            <input type="text" id="product-sku" name="product-sku" class="form-input" required>
                                            <div class="error-message"></div>
                                        </div>
                                        <div class="form-group">
                                            <label for="product-description">Descripci√≥n</label>
                                            <textarea id="product-description" name="product-description" class="form-input" rows="2"></textarea>
                                        </div>
                                        <button type="button" id="add-product-btn" class="btn btn-secondary btn-sm">A√±adir Producto</button>
                                    </form>
                                    <hr>
                                    <h6>Productos del Proveedor:</h6>
                                    <ul id="products-list-for-provider" class="item-list" style="max-height: 150px;">
                                        <!-- Productos del proveedor seleccionado se listar√°n aqu√≠ -->
                                    </ul>
                                </div>
                                <hr style="margin: 25px 0;">
                                <div id="specific-workflow-config-section">
                                    <h5>Configuraci√≥n de Workflow Espec√≠fico para <span id="specific-workflow-target-name">[Proveedor/Producto]</span></h5>
                                    <p><em>Los bloques heredados del workflow general se muestran con un fondo diferente. Puede a√±adir acciones espec√≠ficas para este proveedor/producto.</em></p>

                                    <div class="workflow-config-area" id="specific-workflow-area">
                                        <!-- Secci√≥n Flujo de Entrada Espec√≠fico -->
                                        <div class="workflow-section" id="specific-workflow-entrada">
                                            <h4>Flujo de Entrada Espec√≠fico</h4>
                                            <div class="workflow-palette">
                                                <select class="form-input workflow-node-select specific-select" data-flow-type="entrada-especifico">
                                                    <option value="">Seleccionar acci√≥n para a√±adir...</option>
                                                    <!-- Opciones se poblar√°n con JS -->
                                                </select>
                                                <button type="button" class="btn btn-secondary btn-sm add-workflow-node-btn specific-btn" data-flow-type="entrada-especifico">A√±adir Acci√≥n Espec√≠fica</button>
                                            </div>
                                            <div class="workflow-blocks-container specific-blocks-container" data-flow-type="entrada-especifico" data-general-flow-type="entrada">
                                                <!-- Bloques heredados y espec√≠ficos para flujo de entrada -->
                                            </div>
                                        </div>

                                        <!-- Secci√≥n Flujo de Almac√©n Espec√≠fico -->
                                        <div class="workflow-section" id="specific-workflow-almacen">
                                            <h4>Flujo de Almac√©n Espec√≠fico</h4>
                                            <div class="workflow-palette">
                                                <select class="form-input workflow-node-select specific-select" data-flow-type="almacen-especifico">
                                                    <option value="">Seleccionar acci√≥n para a√±adir...</option>
                                                </select>
                                                <button type="button" class="btn btn-secondary btn-sm add-workflow-node-btn specific-btn" data-flow-type="almacen-especifico">A√±adir Acci√≥n Espec√≠fica</button>
                                            </div>
                                            <div class="workflow-blocks-container specific-blocks-container" data-flow-type="almacen-especifico" data-general-flow-type="almacen">
                                                <!-- Bloques heredados y espec√≠ficos para flujo de almac√©n -->
                                            </div>
                                        </div>

                                        <!-- Secci√≥n Flujo de Salida Espec√≠fico -->
                                        <div class="workflow-section" id="specific-workflow-salida">
                                            <h4>Flujo de Salida Espec√≠fico</h4>
                                            <div class="workflow-palette">
                                                <select class="form-input workflow-node-select specific-select" data-flow-type="salida-especifico">
                                                    <option value="">Seleccionar acci√≥n para a√±adir...</option>
                                                </select>
                                                <button type="button" class="btn btn-secondary btn-sm add-workflow-node-btn specific-btn" data-flow-type="salida-especifico">A√±adir Acci√≥n Espec√≠fica</button>
                                            </div>
                                            <div class="workflow-blocks-container specific-blocks-container" data-flow-type="salida-especifico" data-general-flow-type="salida">
                                                <!-- Bloques heredados y espec√≠ficos para flujo de salida -->
                                            </div>
                                        </div>
                                    </div>
                                    <div id="step5-workflow-error-message" class="error-message" style="margin-top:10px;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="step5-error-message" class="error-message" style="margin-top:15px;"></div>
                </div>
                <div class="wizard-step" data-step="6"> <!-- Anterior Paso 5 ahora es 6 -->
                    <h3>Paso 6: Configuraci√≥n Completada</h3>
                    <!-- Contenido del Paso 6 (Resumen simplificado) ir√° aqu√≠ -->
                    <p>¬°Configuraci√≥n inicial guardada!</p>
                </div>
            </div>
            <div class="wizard-navigation">
                <button id="wizard-prev-btn" class="btn btn-secondary">Anterior</button>
                <button id="wizard-next-btn" class="btn btn-primary">Siguiente</button>
                <button id="wizard-finish-btn" class="btn btn-success" style="display: none;">Finalizar</button>
            </div>
        </div>
    </div>
    <!-- Fin Wizard Modal -->
</body>

</html>